<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Events | Karam Libnan</title>
<link rel="stylesheet" href="css/styles.css" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <!-- Navigation Component -->
  <div id="navigation-container"></div>

  <!-- Main Content Wrapper -->
  <div class="main-content">
    <section class="section-padding">
  <div class="container">
    <h1 class="section-title">Events</h1>
    <p>Upcoming tasting sessions, market appearances, and cultural showcases.</p>
    <div class="grid cards-3" id="eventsGrid">
      <!-- Events will be loaded dynamically from database -->
    </div>
  </div>
    </section>
  </div> <!-- End Main Content -->

<footer class="site-footer">
  <div class="container footer-grid">
    <div class="footer-brand">
      <div class="logo">Karam <span>Libnan</span></div>
      <p>Authentic Lebanese homemade & canned products.</p>
    </div>
  </div>
  <div class="sub-footer"><p>&copy; <span id="year"></span> Karam Libnan.</p></div>
</footer>
  <!-- Load Navigation Component -->
  <script>
    // Load navigation component
    fetch('components/navigation.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('navigation-container').innerHTML = data;
        // Initialize navigation after loading
        if (typeof initializeNavigation === 'function') {
          initializeNavigation();
        }
      })
      .catch(error => console.error('Error loading navigation:', error));
  </script>
  <script src="js/app.js" defer></script>
  
  <!-- Events Loading Script -->
  <script>
    // Load events from database
    async function loadEvents() {
      try {
        const { data: events, error } = await supabase
          .from('events')
          .select('*')
          .eq('is_active', true)
          .order('event_date', { ascending: true });

        if (error) throw error;

        const container = document.getElementById('eventsGrid');
        
        if (!events || events.length === 0) {
          container.innerHTML = '<div class="no-events"><p>No upcoming events at the moment. Check back soon!</p></div>';
          return;
        }

        container.innerHTML = events.map(event => `
          <article class="card">
            ${event.image_url ? `<img src="${event.image_url}" alt="${event.title_en}" class="card-image">` : ''}
            <div class="card-body">
              <h3 class="card-title">${currentLang === 'ar' && event.title_ar ? event.title_ar : event.title_en}</h3>
              <p>${currentLang === 'ar' && event.description_ar ? event.description_ar : event.description_en || 'More details coming soon.'}</p>
              <p><strong data-i18n="events.date">Date:</strong> ${event.event_date ? new Date(event.event_date).toLocaleDateString() : 'TBA'}</p>
            </div>
          </article>
        `).join('');
      } catch (error) {
        console.error('Error loading events:', error);
        document.getElementById('eventsGrid').innerHTML = '<div class="error">Error loading events. Please try again later.</div>';
      }
    }

    // Load events when page loads and when language changes
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for supabase to be available
      if (typeof supabase !== 'undefined') {
        loadEvents();
      } else {
        // Retry after a short delay if supabase isn't loaded yet
        setTimeout(() => {
          if (typeof supabase !== 'undefined') {
            loadEvents();
          }
        }, 1000);
      }
    });

    // Reload events when language changes
    document.addEventListener('languageChanged', loadEvents);
  </script>
</body>
</html>
