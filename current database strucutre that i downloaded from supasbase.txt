-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.audit_logs (
  id bigint NOT NULL DEFAULT nextval('audit_logs_id_seq'::regclass),
  table_name text NOT NULL,
  record_id text NOT NULL,
  action text NOT NULL CHECK (action = ANY (ARRAY['INSERT'::text, 'UPDATE'::text, 'DELETE'::text])),
  user_id uuid,
  old_data jsonb,
  new_data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT audit_logs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.main_categories (
  slug text NOT NULL,
  title_en text NOT NULL,
  title_ar text,
  sort_order integer DEFAULT 0,
  active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT main_categories_pkey PRIMARY KEY (slug)
);
CREATE TABLE public.media (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  file_path text NOT NULL,
  file_name text,
  file_size bigint,
  mime_type text,
  alt_en text,
  alt_ar text,
  linked_type text,
  linked_id text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT media_pkey PRIMARY KEY (id)
);
CREATE TABLE public.product_sections (
  id bigint NOT NULL DEFAULT nextval('product_sections_id_seq'::regclass),
  product_id bigint NOT NULL,
  section_key text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT product_sections_pkey PRIMARY KEY (id),
  CONSTRAINT product_sections_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT product_sections_section_key_fkey FOREIGN KEY (section_key) REFERENCES public.sections(key)
);
CREATE TABLE public.products (
  id bigint NOT NULL DEFAULT nextval('products_id_seq'::regclass),
  name_en text NOT NULL,
  name_ar text,
  description_en text,
  description_ar text,
  main_type text NOT NULL,
  sub_slug text,
  image_url text,
  featured boolean DEFAULT false,
  active boolean DEFAULT true,
  ingredients jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  tsv tsvector,
  tags jsonb DEFAULT '[]'::jsonb,
  variants jsonb DEFAULT '[]'::jsonb,
  ingredients_ar jsonb DEFAULT '[]'::jsonb,
  variants_ar jsonb DEFAULT '[]'::jsonb,
  tags_ar jsonb DEFAULT '[]'::jsonb,
  sort_order integer DEFAULT 999,
  CONSTRAINT products_pkey PRIMARY KEY (id),
  CONSTRAINT products_sub_slug_fkey FOREIGN KEY (sub_slug) REFERENCES public.subcategories(slug),
  CONSTRAINT fk_products_main_category FOREIGN KEY (main_type) REFERENCES public.main_categories(slug)
);
CREATE TABLE public.sections (
  key text NOT NULL,
  title_en text,
  title_ar text,
  content_en text,
  content_ar text,
  image_url text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  sort_order integer DEFAULT 0,
  body_en text,
  body_ar text,
  CONSTRAINT sections_pkey PRIMARY KEY (key)
);
CREATE TABLE public.subcategories (
  slug text NOT NULL,
  category_type text NOT NULL,
  title_en text NOT NULL,
  title_ar text,
  banner_image_url text,
  sort_order integer DEFAULT 0,
  active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT subcategories_pkey PRIMARY KEY (slug),
  CONSTRAINT fk_subcategories_main_category FOREIGN KEY (category_type) REFERENCES public.main_categories(slug)
);